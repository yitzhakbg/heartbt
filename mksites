#
# Script to generate Hebrew site, rename index.xml files and their references to hindex.xml,
# rename top index.html to hindex.html then merge all into the English site.
# Result is to have both English and Hebrew cooexisting in the same branch
#
targ=public
htarg=hpublic
rm -rf $targ/* $htarg/*
# Move branches out of the way for a moment
#
rm -rf content/*
# Copy Hebrew for first pass make
cp -a lang/he/* content
# Make Hebrew site in hpublic
hugo --config="configh.toml" -d $htarg -t redlounge -b http://localhost:1313
# Change index.* in all the index files to hindex.*
dir=$htarg
find $dir -type f -name 'index.*' -exec sed -i '' s/index.xml/hindex.xml/ {} +
# Change all the index.* files to hindex.*
for file in $(find $dir -type f -name index.xml); do
    mv $file $(dirname "${file}")/hindex.xml
done
mv $dir/{,h}index.html
# Now English
rm -rf content/*
cp -a lang/en/* content
hugo --config="confige.toml" -t redlounge -b http://localhost:1313
# Change target="_blank" to target="_self" inside language href, like this:
# <a href="http://localhost:1313/eindex.html" target="_self"><i class='fa fa-language'></i></a>
cp public/index.html public/eindex.html && cp public/index.xml public/eindex.xml

# serve eindex.html should be home the home page
hugo server --config="confige.toml" -d $targ --disableLiveReload -t redlounge -b http://localhost:1313
# Sync Hebrew
rsync -a --exclude={/images/,/css/,/js/,/data/,/docs/,/slides/} $htarg/* $targ
# cp public/eindex.html public/index.html && cp public/eindex.xml public/index.xml
